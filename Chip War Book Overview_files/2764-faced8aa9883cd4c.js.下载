"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2764],{165:(e,t,i)=>{i.d(t,{QR:()=>o,Vt:()=>a,v1:()=>n});var r=i(9509);let n="0000000000000000000000000000",a="00000000-0000-0000-0000-000000000000";r.env.JWT_SECRET_KEY;let o="X-User-ID"},239:(e,t,i)=>{i.d(t,{I:()=>n});var r=i(2115);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480,[i,n]=(0,r.useState)(e);return(0,r.useEffect)(()=>{let e=()=>{n(window.screen.width<=t)};if(e(),"undefined"==typeof ResizeObserver)return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)};{let t=new ResizeObserver(()=>{e()});return t.observe(document.body),()=>{t.disconnect()}}},[t]),i}},626:(e,t,i)=>{i.d(t,{d:()=>f});var r=i(5155),n=i(5427),a=i(2115),o=i(1495),s=i(239),c=i(6846),l=i(8834),u=i.n(l),d=function(e){return e.Hover="hover",e.Click="click",e.None="none",e}({});let p=e=>{let{emoji:t,className:i,width:n=20,height:s=20,selected:c=!1,triggerType:l="hover",...d}=e,p=(0,a.useRef)(null),[h,f]=(0,a.useState)(!1),m=(0,a.useRef)(null),{getLottieData:v}=(0,o.k)(),y=(0,a.useRef)(""),[g,w]=(0,a.useState)(!1),j=(0,a.useCallback)(()=>{m.current&&(m.current.destroy(),m.current=null),w(!1)},[]),x=(0,a.useCallback)(function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!p.current||!(null==t?void 0:t.lottie))return;if(t.lottie===y.current&&m.current){w(!0);return}y.current=t.lottie,j();let i=v(t.lottie);m.current=u().loadAnimation({container:p.current,renderer:"svg",loop:e,autoplay:!0,...i?{animationData:i}:{path:t.lottie}}),m.current.addEventListener("DOMLoaded",()=>{w(!0)}),m.current.addEventListener("error",j)},[null==t?void 0:t.lottie,v,j]);(0,a.useEffect)(()=>{"hover"===l&&(h?x():j())},[h,x,j,l]),(0,a.useEffect)(()=>{"click"===l&&(c?x(!1):j())},[c,x,j,l]),(0,a.useEffect)(()=>j,[j]);let b="".concat(null==t?void 0:t.interaction_type,"-").concat(n,"-").concat(s),_=()=>"none"!==l&&("hover"===l?h:"click"===l&&c);return(0,r.jsx)("div",{className:i,...d,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:(0,r.jsxs)("div",{style:{position:"relative",width:n,height:s},children:[(0,r.jsx)("div",{ref:p,style:{position:"absolute",top:0,left:0,width:n,height:s,opacity:g&&_()?1:0,zIndex:1}}),(0,r.jsx)("div",{style:{position:"absolute",top:0,left:0,width:n,height:s,opacity:g&&_()?0:1},children:(null==t?void 0:t.icon)?(0,r.jsx)("img",{src:t.icon,alt:(null==t?void 0:t.display_name)||"",width:n,height:s,style:{width:n,height:s}},b):null})]})})},h=e=>{let{isOpen:t,onEmojiSelect:i,onClose:n,onMouseEnter:s,onMouseLeave:c,className:l}=e,[u,d]=(0,a.useState)([]),{asyncGetEmojis:h}=(0,o.k)(),f=(0,a.useRef)(null);(0,a.useEffect)(()=>{t&&h().then(e=>{console.log("asyncGetEmojis",e),d(e)})},[t]);let m=e=>{i(e),n()};return t?(0,r.jsx)("div",{className:"absolute top-[-50px] right-0 z-50 h-[54px] w-[268px] items-start justify-items-start ".concat(l),onMouseEnter:s,onMouseLeave:c,children:(0,r.jsx)("div",{className:"flex h-[44px] w-full flex-col items-center justify-center rounded-[8px] bg-white shadow-lg",id:"emoji-picker",ref:f,children:(0,r.jsx)("div",{className:"flex flex-wrap items-center justify-center gap-3",children:u.map(e=>(0,r.jsx)("button",{className:"flex h-5 w-5 cursor-pointer items-center justify-center border-none",onClick:t=>{t.stopPropagation(),t.preventDefault(),m(e)},title:e.display_name,children:(0,r.jsx)(p,{emoji:e,className:"h-5 w-5"})},e.interaction_type))})})}):null},f=e=>{let{emojiCounts:t,emojiStatuses:i,className:l,pickerClassName:u,onEmojiClick:f,showAddButton:m=!1,scrollable:v=!0,fromMask:y="from-[#fff]"}=e,{emojis:g}=(0,o.k)(),[w,j]=(0,a.useState)(!1),[x,b]=(0,a.useState)(!1),[_,E]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),T=(0,s.I)(),O=(0,a.useRef)(null),L=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=()=>{if(L.current){let{scrollLeft:e,scrollWidth:t,clientWidth:i}=L.current;E(e>0),S(e<t-i)}},t=L.current;return t&&(e(),t.addEventListener("scroll",e),window.addEventListener("resize",e)),()=>{t&&(t.removeEventListener("scroll",e),window.removeEventListener("resize",e))}},[]);let M=e=>{var t;return(null===(t=i.find(t=>t.interaction_type===e))||void 0===t?void 0:t.status)===!0};return(0,r.jsxs)("div",{className:(0,c.cn)("relative flex justify-end gap-[6px]",l),children:[v&&(0,r.jsxs)(r.Fragment,{children:[_&&(0,r.jsx)("div",{className:(0,c.cn)("pointer-events-none absolute top-0 bottom-0 left-[-2px] z-10 w-6 bg-gradient-to-r to-transparent",y)}),k&&(0,r.jsx)("div",{className:(0,c.cn)("pointer-events-none absolute top-0 bottom-0 z-10 w-6 bg-gradient-to-l to-transparent",y,m?"right-7":"right-0")})]}),(0,r.jsx)("div",{ref:L,className:(0,c.cn)("flex max-h-6 min-w-0 gap-[6px]",v?"flex-nowrap overflow-x-auto whitespace-nowrap [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden":"flex-wrap overflow-hidden"),children:t.map(e=>(0,r.jsxs)("div",{className:(0,c.cn)("flex h-[24px] cursor-pointer items-center gap-1 rounded-[8px] px-2 py-1",M(e.interaction_type)?"bg-[#252525]":"bg-[rgba(30,30,30,0.06)]"),style:{direction:"ltr"},onClick:t=>{t.stopPropagation(),t.preventDefault(),f(e.interaction_type)},children:[(0,r.jsx)(p,{emoji:g.find(t=>t.interaction_type===e.interaction_type),className:"h-4 w-4",width:16,height:16,triggerType:d.Click,selected:M(e.interaction_type)}),(0,r.jsx)("span",{className:(0,c.cn)("text-xs font-medium",M(e.interaction_type)?"text-white":"text-black"),children:e.count})]},e.interaction_type))}),m&&(0,r.jsx)("div",{className:"flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center rounded-[8px] bg-black/3 p-1",style:{direction:"ltr"},onClick:e=>{e.stopPropagation(),e.preventDefault(),j(!w)},onMouseEnter:()=>{T||(O.current&&clearTimeout(O.current),j(!0))},onMouseLeave:()=>{T||x||(O.current=setTimeout(()=>{j(!1)},100))},children:(0,r.jsx)(n.kpC,{className:"h-4 w-4 text-black/12"})}),w&&(0,r.jsx)(h,{isOpen:w,className:u,onEmojiSelect:e=>{f(e.interaction_type),j(!1)},onClose:()=>{j(!1)},onMouseEnter:()=>{T||(O.current&&clearTimeout(O.current),b(!0))},onMouseLeave:()=>{T||(b(!1),O.current=setTimeout(()=>{j(!1)},100))}})]})}},1495:(e,t,i)=>{i.d(t,{EmojiProvider:()=>S,k:()=>T});var r=i(5155),n=i(2115),a=i(8175),o=i(2374);class s{addOperation(e,t,i,r){let n="".concat(e.project_id,"-").concat(t,"-").concat(Date.now());this.queue=this.queue.filter(i=>!(i.project_id===e.project_id&&i.interaction_type===t&&!this.isOperationInProgress(i.id)));let a=e.interaction||{count:[],status:[]};if(a=this.calculateUpdatedInteraction(e,t,i),(this.callbacks.get(e.project_id)||new Set).forEach(t=>{t(e.project_id,a)}),!r)return n;let o={id:n,project_id:e.project_id,interaction_type:t,action:i,timestamp:Date.now()};return this.queue.push(o),this.scheduleBatch(),n}registerCallback(e,t){var i;return this.callbacks.has(e)||this.callbacks.set(e,new Set),null===(i=this.callbacks.get(e))||void 0===i||i.add(t),()=>{let i=this.callbacks.get(e);i&&(i.delete(t),0===i.size&&this.callbacks.delete(e))}}isOperationInProgress(e){return this.processingOperations.has(e)}getOperationKey(e){return"".concat(e.project_id,"-").concat(e.interaction_type)}scheduleBatch(){this.batchTimer&&clearTimeout(this.batchTimer),this.batchTimer=setTimeout(()=>{this.processQueue()},this.batchDelay)}async processQueue(){if(0===this.queue.length)return;this.batchTimer=null;let e=new Map;for(let i of this.queue){var t;let r=this.getOperationKey(i);e.has(r)||e.set(r,[]),null===(t=e.get(r))||void 0===t||t.push(i)}let i=[];for(let[t,r]of e.entries()){if(this.processingOperations.has(t))continue;let e=r[0];i.push(this.processOperation(e,t))}i.length>0&&(await Promise.all(i),this.queue.length>0&&this.scheduleBatch())}async processOperation(e,t){this.processingOperations.add(t),this.processingOperations.add(e.id);try{await (0,o.tw)(e.project_id,e.action,e.interaction_type),this.queue=this.queue.filter(t=>t.id!==e.id)}catch(t){console.error("Failed to process interaction operation:",t),this.queue=this.queue.filter(t=>t.id!==e.id)}finally{this.processingOperations.delete(t),this.processingOperations.delete(e.id)}}calculateUpdatedInteraction(e,t,i){var r,n;let a=[...(null===(r=e.interaction)||void 0===r?void 0:r.count)||[]],s=[...(null===(n=e.interaction)||void 0===n?void 0:n.status)||[]],c=s.findIndex(e=>e.interaction_type===t);c>=0?s[c]={...s[c],status:i===o.f3.Add}:i===o.f3.Add&&s.push({interaction_type:t,status:!0});let l=a.findIndex(e=>e.interaction_type===t);if(l>=0){let e=i===o.f3.Add?1:-1;a[l]={...a[l],count:Math.max(0,a[l].count+e)}}else i===o.f3.Add&&a.push({interaction_type:t,count:1});return{count:a,status:s}}constructor(){this.queue=[],this.processingOperations=new Set,this.batchTimer=null,this.batchDelay=500,this.callbacks=new Map}}let c="yourware-emoji-list",l="yourware-emoji-lottie-cache",u=[],d=!1,p=[],h={},f=new Map,m=!1,v=e=>{p.forEach(t=>t(e)),p=[]},y=()=>{try{let e=localStorage.getItem(l);e&&(h=JSON.parse(atob(e)))}catch(e){console.error("Failed to load Lottie cache",e),h={},localStorage.removeItem(l)}},g=()=>{try{localStorage.setItem(l,btoa(JSON.stringify(h)))}catch(e){console.error("Failed to save Lottie cache",e)}},w=async e=>{if(!e||h[e]&&h[e].expireTime>Date.now()&&h[e].data)return;if(f.has(e))return f.get(e);let t=(async()=>{try{console.log("Start loading Lottie: ".concat(e));let t=await fetch(e),i=await t.json();h[e]={data:i,expireTime:Date.now()+864e5},g(),console.log("Lottie loaded successfully: ".concat(e))}catch(t){console.error("Failed to preload Lottie: ".concat(e),t)}finally{f.delete(e)}})();return f.set(e,t),t},j=e=>{m||(m=!0,y(),setTimeout(async()=>{try{console.log("Start preloading all Lottie animations");let t=e.filter(e=>e.lottie).map(e=>e.lottie);await Promise.all([...new Set(t)].map(e=>w(e))),console.log("All Lottie animations preloaded successfully")}catch(e){console.error("Failed to preload Lottie animations",e)}finally{m=!1}},2e3))},x=e=>e?h[e]&&h[e].expireTime>Date.now()&&h[e].data?h[e].data:(f.has(e)||setTimeout(()=>{w(e).catch(console.error)},0),null):null,b=()=>{try{let e=localStorage.getItem(c);if(!e)return{data:[],isExpired:!0};let t=JSON.parse(atob(e)),i=t.expireTime<Date.now();return{data:t.data,isExpired:i}}catch(e){return console.error("Failed to read emoji cache",e),localStorage.removeItem(c),{data:[],isExpired:!0}}},_=e=>{try{let t={data:e,expireTime:Date.now()+3e5};localStorage.setItem(c,btoa(JSON.stringify(t)))}catch(e){console.error("Failed to save emoji cache",e)}},E=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(d)return new Promise(e=>{p.push(e)});if(u.length>0&&!e)return u;if(!e){let{data:e,isExpired:t}=b();if(e.length>0)return u=e,t?setTimeout(()=>{E(!0).catch(console.error)},0):m||j(e),u}try{d=!0;let e=(await (0,o.hl)()).data||[];return u=e,_(e),m||j(e),v(e),e}catch(e){return console.error("Failed to fetch emojis",e),v(u),u}finally{d=!1}},k=(0,n.createContext)({emojis:[],isLoading:!1,getEmojiByType:()=>void 0,refreshEmojis:async()=>{},asyncGetEmojis:async()=>[],getLottieData:()=>null,interact:()=>Promise.resolve(""),registerInteractionCallback:()=>{}}),S=e=>{let{children:t}=e,[i,o]=(0,n.useState)([]),[c,l]=(0,n.useState)(!1),{user:d}=(0,a.A)(),p=(0,n.useRef)(new s);(0,n.useEffect)(()=>{y()},[]),(0,n.useEffect)(()=>{let e=!0;return(async()=>{l(!0);let t=await h();e&&(o(t),l(!1))})(),()=>{e=!1}},[]);let h=async()=>{if(u.length>0){let{isExpired:e}=b();return e&&!c&&setTimeout(()=>{E(!0).catch(console.error)},0),u}return E()},f=async(e,t,i)=>p.current.addOperation(e,t,i,(null==d?void 0:d.uid)||""),m=async()=>{await E(!0)};return(0,r.jsx)(k.Provider,{value:{emojis:i,isLoading:c,getEmojiByType:e=>i.find(t=>t.interaction_type===e),refreshEmojis:m,asyncGetEmojis:h,getLottieData:x,interact:f,registerInteractionCallback:(e,t)=>{p.current.registerCallback(e,t)}},children:t})},T=()=>(0,n.useContext)(k)},1884:(e,t,i)=>{i.d(t,{Z:()=>r});function r(e){return e>1e3&&e<1e6?(e/1e3).toFixed(1)+"K":e>1e6?(e/1e6).toFixed(1)+"M":e>1e9?(e/1e9).toFixed(1)+"B":e}},2374:(e,t,i)=>{i.d(t,{f3:()=>a,hl:()=>s,tw:()=>o});var r=i(466);let n={interact:"/v1/community/interact",emoji_list:"/v1/community/emoji/list"};var a=function(e){return e.Add="add",e.Cancel="cancel",e}({});async function o(e,t,i){return await (0,r.qM)(n.interact,{method:"POST",data:{project_id:e,action:t,interaction_type:i}})}async function s(){return await (0,r.qM)(n.emoji_list,{method:"GET"})}},6846:(e,t,i)=>{i.d(t,{cn:()=>a});var r=i(2596),n=i(9688);function a(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,n.QP)((0,r.$)(t))}},7794:(e,t,i)=>{i.d(t,{Fe:()=>d,IT:()=>u,JQ:()=>a,Ok:()=>o,Tm:()=>l,vF:()=>s,vr:()=>c});var r=i(165),n=i(466);async function a(e){return await (0,n.qM)("/v1/projects".concat(e?"?".concat(new URLSearchParams(e)):""))}async function o(e,t,i,r){let a={user_id:e,project_id:t,visibility:i};return r&&(a.subdomain=r),await (0,n.qM)("/v1/projects/set_visibility",{method:"POST",data:a})}async function s(e){return await (0,n.qM)("/v1/project/detail?project_id=".concat(e),{method:"GET"})}async function c(e){let t={project_id:e.project_id,user_id:e.user_id,...e.content};return await (0,n.qM)("/v1/projects/update",{method:"POST",data:t})}async function l(e){return await (0,n.qM)("/v1/projects/remix",{method:"POST",data:{project_id:e}})}async function u(e,t){return await (0,n.qM)("/v1/projects/init",{method:"POST",data:{project_id:e},extra_headers:t?{[r.QR]:t}:void 0})}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"view";await (0,n.qM)("/v1/projects/stats/incr",{method:"POST",data:{project_id:e,stats_type:t}})}}}]);